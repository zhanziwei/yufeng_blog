---
layout: post
title: 类型信息
date: 2021-04-19
Author: yufeng 
tags: [Java]
comments: true
toc: true
---

## 什么是RTTI

RTTI（Runtime Type Information，运行时类型信息），能够在程序运行时发现和使用类型信息，Java在运行时识别对象和类信息主要有两种方法：

1. 传统的RTTI：假定在编译时就已经知道了所有的类型
2. 反射机制：在运行时发现和使用类的信息

#### 为什么需要RTTI

当对象向上转型后我们仍需要知道它的具体类型，可以使用RTTI，查询某个基类引用所指向对象的确切类型

#### Class对象

Class对象是用来创建该类所有常规对象。每个类都有一个Class对象。为了生成这个类的对象，Java虚拟机先会调用类加载器把类加载到内存中。

所有的类都是第一次使用时动态加载到 JVM 中的，当程序创建第一个对类的静态成员的引用时，就会加载这个类。

其实构造器也是类的静态方法，虽然构造器前面并没有 `static` 关键字。所以，使用 `new` 操作符创建类的新对象，这个操作也算作对类的静态成员引用。

所有 `Class` 对象都属于 `Class` 类，而且它跟其他普通对象一样，我们可以获取和操控它的引用(这也是类加载器的工作)。`forName()` 是 `Class` 类的一个静态方法，我们可以使用 `forName()` 根据目标类的类名（`String`）得到该类的 `Class` 对象。

如果你已经拥有了目标类的对象，那就可以通过调用 `getClass()` 方法来获取 `Class` 引用了，这个方法来自根类 `Object`，它将返回表示该对象实际类型的 `Class` 对象的引用。

#### 类字面常量

Java 还提供了另一种方法来生成类对象的引用：**类字面常量**。对上述程序来说，就像这样：`FancyToy.class;`。这样做不仅更简单，而且更安全，因为它在编译时就会受到检查（因此不必放在 `try` 语句块中）。并且它根除了对 `forName()` 方法的调用，所以效率更高。

#### instanceof关键字与isInstance方法

关于instanceof 关键字，它返回一个boolean类型的值，意在告诉我们对象是不是某个特定的类型实例。而isInstance方法则是Class类中的一个Native方法，也是用于判断对象类型的。

事实上instanceOf 与isInstance方法产生的结果是相同的。对于instanceOf是关键字只被用于对象引用变量，检查左边对象是不是右边类或接口的实例化。如果被测对象是null值，则测试结果总是false。

而isInstance方法则是Class类的Native方法，其中obj是被测试的对象或者变量，如果obj是调用这个方法的class或接口的实例，则返回true。如果被检测的对象是null或者基本类型，那么返回值是false。

#### 反射机制

反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法和属性，这种动态获取的信息以及动态调用对象的方法的功能称为java语言的反射机制。它们都存在于java.lang.reflect中，在反射中，我们常用的类：

1. Constructor类

   表示Class对象所表示的类的构造方法，利用它可以在运行时动态创建对象

2. Field

   表示Class对象所表示的类的成员变量，通过它可以在运行时动态修改成员变量的属性值（包括private）

3. Method

   Method表示Class对象所表示的类的成员方法，通过它可以动态调用对象的方法（包括private）

